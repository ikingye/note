<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="2020 年 4 月 8 日（星期三） 今日待办     编程 依赖注入 可以通过多种方式为实例提供必要的依赖关系：
 构造函数注入 属性注入 方法注入  构造函数注入 构造函数注入是许多依赖注入框架的首选方法，常受依赖注入框架的青睐。
它清楚地告诉我们创建特定组件所需的所有依赖关系，并且这些依赖不是可选的，这些依赖关系在整个组件中应该都是必需的。
public class DataProcessor { private final DbManager manager; private final Calculator calculator; public DataProcessor(DbManager manager, Calculator calculator) { this.manager = manager; this.calculator = calculator; } // ... }  优点：  不变性：依赖关系始终如初。   缺点  必须在初始化时提供所有依赖项。  有时，我们无法自己初始化一个组件，或者在某个时刻我们无法提供组件的所有依赖关系。或者我们需要使用另外一个构造函数。一旦设置了依赖项，我们就无法再改变它们了。      属性注入 属性注入更适合可选参数，例如监听或委托。又或是我们无法在初始化时提供依赖关系。
其它编程语言，例如 Swift，大量使用了带属性的 委托模式。因此，使用属性注入将使其它语言的开发人员更熟悉我们的代码。"><meta property="og:title" content="2020-04-08" />
<meta property="og:description" content="2020 年 4 月 8 日（星期三） 今日待办     编程 依赖注入 可以通过多种方式为实例提供必要的依赖关系：
 构造函数注入 属性注入 方法注入  构造函数注入 构造函数注入是许多依赖注入框架的首选方法，常受依赖注入框架的青睐。
它清楚地告诉我们创建特定组件所需的所有依赖关系，并且这些依赖不是可选的，这些依赖关系在整个组件中应该都是必需的。
public class DataProcessor { private final DbManager manager; private final Calculator calculator; public DataProcessor(DbManager manager, Calculator calculator) { this.manager = manager; this.calculator = calculator; } // ... }  优点：  不变性：依赖关系始终如初。   缺点  必须在初始化时提供所有依赖项。  有时，我们无法自己初始化一个组件，或者在某个时刻我们无法提供组件的所有依赖关系。或者我们需要使用另外一个构造函数。一旦设置了依赖项，我们就无法再改变它们了。      属性注入 属性注入更适合可选参数，例如监听或委托。又或是我们无法在初始化时提供依赖关系。
其它编程语言，例如 Swift，大量使用了带属性的 委托模式。因此，使用属性注入将使其它语言的开发人员更熟悉我们的代码。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ikingye.github.io/note/docs/live/diary/2020/04/08/" />
<meta property="article:modified_time" content="2020-04-16T22:36:57+08:00" />
<title>2020-04-08 | 叶王笔记</title>
<link rel="icon" href="/note/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/note/book.min.2b565af4d61986071164f1ead48c719f32bb138a148802dc3943b967fc4f20c6.css" integrity="sha256-K1Za9NYZhgcRZPHq1IxxnzK7E4oUiALcOUO5Z/xPIMY=">


<script defer src="/note/en.search.min.51eee7c1ca2e4d21f6bb772fa33687be90a4225cacd6931bc290132c33208980.js" integrity="sha256-Ue7nwcouTSH2u3cvozaHvpCkIlys1pMbwpATLDMgiYA="></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/note"><span>叶王笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



<ul>
  <li><a href="https://kingye.me">博客</a></li>
  <li><a href="https://github.com/ikingye">Github</a></li>
  <li><a href="https://www.zhihu.com/people/wutongyip">知乎</a></li>
  <li><a href="https://weibo.com/kingyip15215">微博</a></li>
</ul>
<hr />








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/natural/" class="">第一部分 自然科学</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/natural/math/" class="collapsed ">数学</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/humanities/" class="">第二部分 人文科学</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/humanities/music/" class="collapsed ">音乐</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/humanities/movie/" class="collapsed ">电影</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/social/" class="">第三部分 社会科学</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/social/history/" class="collapsed ">历史</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/study/" class="">第四部分 学习</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/study/book/" class="collapsed ">4.1 读书</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/study/course/" class="collapsed ">4.2 课程</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/study/degree/" class="collapsed ">4.3 学位</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/study/docs/" class="collapsed ">4.4 文档</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/study/domain/" class="collapsed ">4.5 领域</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/live/" class="">第五部分 生活</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/live/diary/" class="collapsed ">5.1 日记</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/live/diary/2020/" class="">2020 年</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note/docs/live/diary/2020/04/" class="">4 月</a>
  


    




  
  <ul>
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/18/" class="">2020-04-18</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/17/" class="">2020-04-17</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/15/" class="">2020-04-15</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/14/" class="">2020-04-14</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/13/" class="">2020-04-13</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/12/" class="">2020-04-12</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/11/" class="">2020-04-11</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/10/" class="">2020-04-10</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/09/" class="">2020-04-09</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/08/" class="active">2020-04-08</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/07/" class="">2020-04-07</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/06/" class="">2020-04-06</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/03/" class="">2020-04-03</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note/docs/live/diary/2020/04/02/" class="">2020-04-02</a>
  

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/live/diary/2020/03/" class="collapsed ">3 月</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/live/parenting/" class="collapsed ">5.2 养育</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/live/cook/" class="collapsed ">下厨房</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note/docs/live/travel/" class="collapsed ">旅行</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  
















</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/note/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>2020-04-08</strong>

  <label for="toc-control">
    <img src="/note/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#2020-年-4-月-8-日星期三">2020 年 4 月 8 日（星期三）</a>
      <ul>
        <li><a href="#今日待办">今日待办</a></li>
        <li><a href="#编程">编程</a>
          <ul>
            <li><a href="#依赖注入">依赖注入</a>
              <ul>
                <li><a href="#构造函数注入">构造函数注入</a></li>
                <li><a href="#属性注入">属性注入</a></li>
                <li><a href="#方法注入">方法注入</a></li>
              </ul>
            </li>
            <li><a href="#rtsphttpswwwwikiwandcomenreal_time_streaming_protocol"><a href="https://www.wikiwand.com/en/Real_Time_Streaming_Protocol">RTSP</a></a></li>
            <li><a href="#发布策略">发布策略</a>
              <ul>
                <li><a href="#蓝绿部署-blue-green-deployments">蓝绿部署 (Blue-green Deployments)</a></li>
                <li><a href="#金丝雀发布-canary-releases">金丝雀发布 (Canary Releases)</a></li>
                <li><a href="#ab-测试-ab-testing">A/B 测试 (A/B Testing)</a></li>
                <li><a href="#流量切分">流量切分</a></li>
              </ul>
            </li>
            <li><a href="#大量-time_wait-状态">大量 time_wait 状态</a>
              <ul>
                <li><a href="#time_wait-是怎么产生的">TIME_WAIT 是怎么产生的？</a>
                  <ul>
                    <li><a href="#连接关闭的过程">连接关闭的过程</a></li>
                    <li><a href="#time_wait-只会出现在主动断开连接的一方">TIME_WAIT 只会出现在主动断开连接的一方</a></li>
                  </ul>
                </li>
                <li><a href="#大量-time_wait-造成的影响">大量 TIME_WAIT 造成的影响</a></li>
                <li><a href="#排查">排查</a>
                  <ul>
                    <li><a href="#查看-tcp-各个状态的数量">查看 TCP 各个状态的数量</a></li>
                    <li><a href="#tcp-状态含义">TCP 状态含义</a></li>
                    <li><a href="#统计-time_wait-连接的本地地址">统计 TIME_WAIT 连接的本地地址</a></li>
                  </ul>
                </li>
                <li><a href="#如何尽量处理-timewait-过多的问题">如何尽量处理 TIMEWAIT 过多的问题？</a>
                  <ul>
                    <li><a href="#修改内核文件-etcsysctlconf">修改内核文件 /etc/sysctl.conf</a></li>
                    <li><a href="#nginx-配置问题">nginx 配置问题</a>
                      <ul>
                        <li><a href="#proxy_pass-与-fastcgi_pass-的区别">proxy_pass 与 fastcgi_pass 的区别</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="#为什么要有-time_wait-状态">为什么要有 TIME_WAIT 状态？</a></li>
              </ul>
            </li>
            <li><a href="#我的-macos-apps">我的 MacOS Apps</a>
              <ul>
                <li><a href="#通用">通用</a></li>
                <li><a href="#编程-1">编程</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#物化生">物化生</a>
          <ul>
            <li><a href="#红外光栅传感器">红外光栅传感器</a>
              <ul>
                <li><a href="#光栅httpsbaikebaiducomiteme58589e6a085"><a href="https://baike.baidu.com/item/%E5%85%89%E6%A0%85">光栅</a></a></li>
                <li><a href="#红外光栅httpsbaikebaiducomiteme7baa2e5a496e58589e6a085-遮挡检测"><a href="https://baike.baidu.com/item/%E7%BA%A2%E5%A4%96%E5%85%89%E6%A0%85">红外光栅</a> 遮挡检测</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#今日总结">今日总结</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="2020-年-4-月-8-日星期三">2020 年 4 月 8 日（星期三）</h1>
<h2 id="今日待办">今日待办</h2>
<ul>
<li><input disabled="" type="checkbox"></li>
</ul>
<hr>
<h2 id="编程">编程</h2>
<h3 id="依赖注入">依赖注入</h3>
<p>可以通过多种方式为实例提供必要的依赖关系：</p>
<ul>
<li>构造函数注入</li>
<li>属性注入</li>
<li>方法注入</li>
</ul>
<h4 id="构造函数注入">构造函数注入</h4>
<p>构造函数注入是许多依赖注入框架的首选方法，常受依赖注入框架的青睐。</p>
<p>它清楚地告诉我们创建特定组件所需的所有依赖关系，并且这些依赖不是可选的，这些依赖关系在整个组件中应该都是必需的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataProcessor</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> DbManager manager<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Calculator calculator<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DataProcessor</span><span style="color:#f92672">(</span>DbManager manager<span style="color:#f92672">,</span> Calculator calculator<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">manager</span> <span style="color:#f92672">=</span> manager<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">calculator</span> <span style="color:#f92672">=</span> calculator<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>优点：
<ul>
<li>不变性：依赖关系始终如初。</li>
</ul>
</li>
<li>缺点
<ul>
<li><strong>必须在初始化时提供所有依赖项</strong>。
<ul>
<li>有时，我们无法自己初始化一个组件，或者在某个时刻我们无法提供组件的所有依赖关系。或者我们需要使用另外一个构造函数。一旦设置了依赖项，我们就无法再改变它们了。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="属性注入">属性注入</h4>
<p>属性注入更适合可选参数，例如监听或委托。又或是我们无法在初始化时提供依赖关系。</p>
<p>其它编程语言，例如 Swift，大量使用了带属性的 委托模式。因此，使用属性注入将使其它语言的开发人员更熟悉我们的代码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataProcessor</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// 外部要提前进行 属性注入，否则调用会出现 NullPointerException
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> DbManager manager <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> Calculator calculator <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">processData</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// WARNING: Possible NPE
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">manager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">processData</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">calc</span><span style="color:#f92672">(</span>BigDecimal input<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// WARNING: Possible NPE
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">calculator</span><span style="color:#f92672">.</span><span style="color:#a6e22e">expensiveCalculation</span><span style="color:#f92672">(</span>input<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>有时，我们无法访问类型实际的初始化方法，只能访问一个<strong>已经初始化的实例</strong>。或者在初始化时，所需要的依赖关系并不像之后那样明确。</p>
<p>在这些情况下，我们可以使用属性注入而不是依赖于构造函数。</p>
<ul>
<li>优点
<ul>
<li>可以通过构造方法注入，也可以通过实例注入</li>
<li>随时注入</li>
</ul>
</li>
<li>缺点
<ul>
<li>易变性，调用前要注入，否则会出现 <code>NullPointerException</code></li>
</ul>
</li>
</ul>
<h4 id="方法注入">方法注入</h4>
<p>如果在每次调用时依赖项可能不同，那么使用方法注入最好不过了。方法注入进一步解耦组件，它使方法本身持有依赖项，而非整个组件。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataProcessor</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">calc</span><span style="color:#f92672">(</span>Calculator calculator<span style="color:#f92672">,</span> BigDecimal input<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> calculator<span style="color:#f92672">.</span><span style="color:#a6e22e">expensiveCalculation</span><span style="color:#f92672">(</span>input<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>优点
<ul>
<li>进一步解耦组件，它使方法本身持有依赖项，而非整个组件</li>
<li>每次调用时依赖项可以不同</li>
</ul>
</li>
<li>缺点
<ul>
<li>每次调用都需要传依赖的实例</li>
</ul>
</li>
</ul>
<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5e80a1d46fb9a03c8c03fe51">[译] 用依赖注入解耦你的代码</a></li>
</ul>
<hr>
<h3 id="rtsphttpswwwwikiwandcomenreal_time_streaming_protocol"><a href="https://www.wikiwand.com/en/Real_Time_Streaming_Protocol">RTSP</a></h3>
<p>Real Time Streaming Protocol</p>
<h3 id="发布策略">发布策略</h3>
<h4 id="蓝绿部署-blue-green-deployments">蓝绿部署 (Blue-green Deployments)</h4>
<p>蓝绿部署的目的是减少发布时的中断时间、能够快速撤回发布。</p>
<p>蓝绿部署中，一共有两套系统：</p>
<ul>
<li>一套是正在提供服务系统，标记为 “绿色”；</li>
<li>另一套是准备发布的系统，标记为 “蓝色”。</li>
</ul>
<p>两套系统都是功能完善的，并且正在运行的系统，只是系统版本和对外服务情况不同。</p>
<h4 id="金丝雀发布-canary-releases">金丝雀发布 (Canary Releases)</h4>
<p>金丝雀发布和国内常说的<strong>灰度发布</strong>是同一类策略。</p>
<p>蓝绿部署是准备两套系统，在两套系统之间进行切换，金丝雀策略是只有一套系统，逐渐替换这套系统。</p>
<p>譬如说，</p>
<ul>
<li>目标系统是一组无状态的 Web 服务器，但是数量非常多，假设有一万台</li>
<li>这时候，蓝绿部署就不能用了，因为你不可能申请一万台服务器专门用来部署蓝色系统
<ul>
<li>在蓝绿部署的定义中，蓝色的系统要能够承接所有访问</li>
</ul>
</li>
<li>可以想到的一个方法是：
<ul>
<li>只准备几台服务器，在上面部署新版本的系统并测试验证。测试通过之后，担心出现意外，还不敢立即更新所有的服务器。 先将线上的一万台服务器中的 10 台更新为最新的系统，然后观察验证</li>
<li>确认没有异常之后，再将剩余的所有服务器更新</li>
</ul>
</li>
</ul>
<ul>
<li>什么时候可以用蓝绿，不能用金丝雀呢？
<ul>
<li>整个系统只有一台服务器的时候。</li>
</ul>
</li>
</ul>
<h4 id="ab-测试-ab-testing">A/B 测试 (A/B Testing)</h4>
<p>蓝绿部署和金丝雀是发布策略，目标是确保新上线的系统稳定，关注的是新系统的 BUG、隐患。
A/B 测试关注的是不同版本的服务的实际效果，譬如说转化率、订单情况等。</p>
<p>A/B 测试是效果测试，同一时间有多个版本的服务对外服务，这些服务都是经过足够测试，达到了上线标准的服务，有差异但是没有新旧之分（它们上线时可能采用了蓝绿部署的方式）。</p>
<p>在 A/B 测试中，需要能够控制流量的分配，譬如说，为 A 版本分配 10% 的流量，为 B 版本分配 10% 的流量，为 C 版本分配 80% 的流量。</p>
<h4 id="流量切分">流量切分</h4>
<ul>
<li>譬如说，给最初更新的 10 台服务器设置较低的权重、控制发送给这 10 台服务器的请求数，然后逐渐提高权重、增加请求数。</li>
<li>既可以用于金丝雀发布，也可以用于 A/B 测试。</li>
</ul>
<hr>
<h3 id="大量-time_wait-状态">大量 time_wait 状态</h3>
<h4 id="time_wait-是怎么产生的">TIME_WAIT 是怎么产生的？</h4>
<h5 id="连接关闭的过程">连接关闭的过程</h5>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200409000158.png" alt="" /></p>
<ul>
<li>主动关闭连接的一方，调用 close ()；协议层发送 FIN 包</li>
<li>被动关闭的一方收到 FIN 包后，协议层回复 ACK；然后被动关闭的一方，进入 <code>CLOSE_WAIT</code> 状态；主动关闭的一方等待对方关闭，则进入 <code>FIN_WAIT_2</code> 状态</li>
<li>被动关闭的一方在完成所有数据发送后，调用 close () 操作，协议层发送 FIN 包给主动关闭的一方，等待对方的 ACK，被动关闭的一方进入 <code>LAST_ACK</code> 状态</li>
<li>主动关闭的一方收到 FIN 包，协议层回复 ACK，主动关闭连接的一方进入 <code>TIME_WAIT</code> 状态；而被动关闭的一方，进入 <code>CLOSED</code> 状态</li>
<li>等待 2MSL 时间，主动关闭的一方，结束 TIME_WAIT，进入 <code>CLOSED</code> 状态</li>
</ul>
<h5 id="time_wait-只会出现在主动断开连接的一方">TIME_WAIT 只会出现在主动断开连接的一方</h5>
<h4 id="大量-time_wait-造成的影响">大量 TIME_WAIT 造成的影响</h4>
<ul>
<li>在<strong>高并发短连接</strong>的 TCP 服务器上，当服务器处理完请求后立刻主动正常关闭连接。
<ul>
<li><strong>短连接</strong>表示 “业务处理 + 传输数据的时间 远远小于 TIMEWAIT 超时的时间” 的连接</li>
<li><strong>高并发</strong>可以让服务器在短时间范围内同时占用大量端口，
<ul>
<li>而端口有个 0~65535 的范围，并不是很多，刨除系统和其他服务要用的，剩下的就更少了。</li>
</ul>
</li>
</ul>
<ul>
<li>在实际业务场景中，一般长连接对应的业务的并发量并不会很高</li>
<li>这些端口都是服务器临时分配，无法用 <code>SO_REUSEADDR</code> 选项解决这个问题</li>
</ul>
</li>
<li>内存
<ul>
<li>内核里有一个保存所有连接的 hash table</li>
<li>不同的内核对这个 hash table 的大小设置不同，你可以通过 dmesg 命令去找到你的内核设置的大小</li>
<li>还有一个 hash table 用来保存所有的 bound ports，主要用于可以快速的找到一个可用的端口或者随机端口</li>
<li>不过占用内存很少很少。 一个 tcp socket 占用不到 4k。1 万条 TIME_WAIT 的连接，也就多消耗 1M 左右的内存</li>
</ul>
</li>
<li>CPU
<ul>
<li>每次找到一个随机端口，还是需要遍历一遍 bound ports 的吧，这必然需要一些 CPU 时间。</li>
</ul>
</li>
<li>源端口数量 (net.ipv4.ip_local_port_range)</li>
<li>TIME_WAIT bucket 数量 (net.ipv4.tcp_max_tw_buckets)</li>
<li>文件描述符数量 (max open file)
<ul>
<li>一个 socket 占用一个文件描述符</li>
</ul>
</li>
</ul>
<h4 id="排查">排查</h4>
<h5 id="查看-tcp-各个状态的数量">查看 TCP 各个状态的数量</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">netstat -ant | awk <span style="color:#e6db74">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print (a,S[a])}&#39;</span> | sort -rn -k2
</code></pre></div><h5 id="tcp-状态含义">TCP 状态含义</h5>
<table>
<thead>
<tr>
<th>TCP 状态</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>LISTEN</td>
<td>服务器在等待进入呼叫</td>
</tr>
<tr>
<td>SYN_RECV</td>
<td>一个连接请求已经到达，等待确认</td>
</tr>
<tr>
<td>SYN_SENT</td>
<td>应用已经开始，打开一个连接</td>
</tr>
<tr>
<td>ESTABLISHED</td>
<td>正常数据传输状态</td>
</tr>
<tr>
<td>FIN_WAIT1</td>
<td>应用说它已经完成</td>
</tr>
<tr>
<td>FIN_WAIT2</td>
<td>另一边已同意释放</td>
</tr>
<tr>
<td>ITMED_WAIT</td>
<td>等待所有分组死掉</td>
</tr>
<tr>
<td>LAST_ACK</td>
<td>等待所有分组死掉</td>
</tr>
<tr>
<td>TIME_WAIT</td>
<td>另一边已初始化一个释放</td>
</tr>
<tr>
<td>CLOSING</td>
<td>两边同时尝试关闭</td>
</tr>
<tr>
<td>CLOSED</td>
<td>无连接是活动的或正在进行</td>
</tr>
</tbody>
</table>
<h5 id="统计-time_wait-连接的本地地址">统计 TIME_WAIT 连接的本地地址</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">netstat -an | grep TIME_WAIT | awk <span style="color:#e6db74">&#39;{print $4}&#39;</span> | sort | uniq -c | sort -rn -k1 | head
</code></pre></div><h4 id="如何尽量处理-timewait-过多的问题">如何尽量处理 TIMEWAIT 过多的问题？</h4>
<h5 id="修改内核文件-etcsysctlconf">修改内核文件 /etc/sysctl.conf</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">net.ipv4.tcp_syncookies <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> 表示开启SYN Cookies。当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYN攻击，默认为0，表示关闭；
net.ipv4.tcp_tw_reuse <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> 表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接，默认为0，表示关闭；
net.ipv4.tcp_tw_recycle <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> 表示开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭。
net.ipv4.tcp_fin_timeout 修改系默认的 TIMEOUT 时间
</code></pre></div><p>然后执行 /sbin/sysctl -p 让参数生效.</p>
<p>/etc/sysctl.conf 是一个允许改变正在运行中的 Linux 系统的接口，它包含一些 TCP/IP 堆栈和虚拟内存系统的高级选项，修改内核参数永久生效。</p>
<p>简单来说，就是打开系统的 TIMEWAIT 重用和快速回收。</p>
<p>如果以上配置调优后性能还不理想，可继续修改一下配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">net.ipv4.tcp_keepalive_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">1200</span>
<span style="color:#75715e">#表示当keepalive起用的时候，TCP发送keepalive消息的频度。缺省是2小时，改为20分钟。</span>
net.ipv4.ip_local_port_range <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#ae81ff">65000</span>
<span style="color:#75715e">#表示用于向外连接的端口范围。缺省情况下很小：32768到61000，改为1024到65000。</span>
net.ipv4.tcp_max_syn_backlog <span style="color:#f92672">=</span> <span style="color:#ae81ff">8192</span>
<span style="color:#75715e">#表示SYN队列的长度，默认为1024，加大队列长度为8192，可以容纳更多等待连接的网络连接数。</span>
net.ipv4.tcp_max_tw_buckets <span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>
<span style="color:#75715e">#表示系统同时保持 TIME_WAIT 套接字的最大数量，如果超过这个数字， TIME_WAIT 套接字将立刻被清除并打印警告信息。</span>
默认为180000，改为5000。对于Apache、Nginx等服务器，上几行的参数可以很好地减少 TIME_WAIT 套接字数量，但是对于 Squid，效果却不大。此项参数可以控制 TIME_WAIT 套接字的最大数量，避免Squid服务器被大量的 TIME_WAIT 套接字拖死。
</code></pre></div><p>参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/dadonggg/p/8778318.html">解决 TIME_WAIT 过多造成的问题</a></li>
</ul>
<hr>
<h5 id="nginx-配置问题">nginx 配置问题</h5>
<ul>
<li>nginx 在配置 &ldquo;不启用 keep-alive&rdquo; 时，会在 http 请求结束时主动断开连接
<ul>
<li>尝试开启 http 的 keep-alive</li>
</ul>
<pre><code>keepalive_timeout 65;
</code></pre></li>
<li>nginx 与 fast-cgi 的默认连接是短连接
<ul>
<li>修改 nginx 配置使其与 fastcgi 的连接使用长连接</li>
</ul>
<pre><code>upstream phpserver{
    server 127.0.0.1:9000 weight=1;
    # upstream 中的 keepalive 指定 nginx 每个 worker 与 fastcgi 的最大长连接数
    keepalive 100
}
</code></pre></li>
<li>若 nginx 与 fast-cgi 在同一台服务器上，则使用 unix 域 会更为高效，同时避免了 TIME_WAIT 的问题</li>
</ul>
<h6 id="proxy_pass-与-fastcgi_pass-的区别">proxy_pass 与 fastcgi_pass 的区别</h6>
<pre><code>客户端
--http--&gt; 前端负载均衡 Nginx
--proxy_pass--&gt; 业务服务器 Nginx
--fastcgi_pass--&gt; 业务服务器 php-fpm
</code></pre><h4 id="为什么要有-time_wait-状态">为什么要有 TIME_WAIT 状态？</h4>
<ul>
<li><strong>可靠地实现 TCP 全双工连接的终止</strong>
<ul>
<li>在进行关闭连接四次挥手协议时，最后的 ACK 是由主动关闭端发出的，如果这个最终的 ACK 丢失，服务器将重发最终的 FIN</li>
<li>因此客户端必须维护状态信息允许它重发最终的 ACK。如果不维持这个状态信息，那么客户端将响应 RST 分节，服务器将此分节解释成一个错误（在 java 中会抛出 connection reset 的 SocketException)。</li>
<li>因而，要实现 TCP 全双工连接的正常终止，必须处理终止序列四个分节中任何一个分节的丢失情况，主动关闭的客户端必须维持状态信息进入 TIME_WAIT 状态。</li>
</ul>
</li>
<li><strong>让老的重复分节在网络中消逝</strong>
<ul>
<li>在关闭一个 TCP 连接后，马上又重新建立起一个相同的 IP 地址和端口之间的 TCP 连接，后一个连接被称为前一个连接的化身（incarnation)，那么有可能出现这种情况，前一个连接的迷途重复分组在前一个连接终止后出现，从而被误解成从属于新的化身。</li>
<li>为了避免这个情况， TCP 不允许处于 TIME_WAIT 状态的连接启动一个新的化身，因为 TIME_WAIT 状态持续 2MSL，就可以保证当成功建立一个 TCP 连接的时候，来自连接先前化身的重复分组已经在网络中消逝。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="我的-macos-apps">我的 MacOS Apps</h3>
<h4 id="通用">通用</h4>
<table>
<thead>
<tr>
<th>软件</th>
<th>类型</th>
<th>评分</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>iTerm</td>
<td>终端</td>
<td>★★★★★</td>
<td></td>
</tr>
<tr>
<td>zoom.us</td>
<td>IM - 视频</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>draw.io</td>
<td>作图</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>PicGo</td>
<td>图床</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Dropbox</td>
<td>备份 - 同步</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Keyboard Maestro</td>
<td>快捷键</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Alfred 4</td>
<td>搜索</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Google Chrome</td>
<td>浏览器</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>OmniDiskSweeper</td>
<td>系统 - 磁盘管理</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>ShiftIt</td>
<td>系统 - 窗口移动</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Telegram</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>QQ</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Skype for Business</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Slack</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>DingDing</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>WeChat</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>WeChat Work</td>
<td>IM</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Keynote</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Microsoft Excel</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Microsoft OneNote</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Microsoft Outlook</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Microsoft PowerPoint</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Microsoft Word</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Numbers</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Pages</td>
<td>Office</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>SwitchHosts!</td>
<td>host 管理</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Axure RP 8</td>
<td>产品</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Sketch</td>
<td>产品 - UI</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>V2RayX</td>
<td>代理</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>OmniGraffle</td>
<td>作图</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Typora</td>
<td>写作 - Markdown</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>OneDrive</td>
<td>备份</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>百度网盘</td>
<td>备份</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Anki</td>
<td>学习</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>LICEcap</td>
<td>录屏 - GIF</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>CheatSheet</td>
<td>快捷键显示</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>XMind</td>
<td>思维导图</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>截图</td>
<td>截图</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>OBS</td>
<td>直播</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Kindle</td>
<td>看书</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Tencent Lemon</td>
<td>系统 - 磁盘清理</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>InsomniaX</td>
<td>系统 - 禁用休眠</td>
<td>★★★</td>
<td>禁用 MacBook 上的合盖休眠</td>
</tr>
<tr>
<td>Scroll Reverser</td>
<td>系统 - 鼠标反转</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>IINA</td>
<td>视频</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>The Unarchiver</td>
<td>解压缩</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>NeteaseMusic</td>
<td>音乐</td>
<td>★★★</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="编程-1">编程</h4>
<table>
<thead>
<tr>
<th>软件</th>
<th>类型</th>
<th>评分</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Visual Studio Code</td>
<td>编辑器</td>
<td>★★★★★</td>
<td></td>
</tr>
<tr>
<td>Docker</td>
<td></td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>GoLand</td>
<td>IDE - Go</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>IntelliJ IDEA</td>
<td>IDE - Java</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>PhpStorm</td>
<td>IDE - PHP / 前端</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Multipass</td>
<td>虚拟机管理</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>Sublime Text</td>
<td>编辑器</td>
<td>★★★★</td>
<td></td>
</tr>
<tr>
<td>nteract</td>
<td></td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Postman</td>
<td>HTTP</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>CLion</td>
<td>IDE - C++</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Robo 3T</td>
<td>IDE - MongoDB</td>
<td>★★★</td>
<td>轻量级 Studio 3T</td>
</tr>
<tr>
<td>Studio 3T</td>
<td>IDE - MongoDB</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Racket v7.2</td>
<td>IDE - Racket</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>MIT/GNU Scheme</td>
<td>IDE - Scheme</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Xcode</td>
<td>IDE - iOS</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>微信开发者工具</td>
<td>IDE - 微信</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Anaconda-Navigator</td>
<td>Python</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Beyond Compare</td>
<td>diff</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Sourcetree</td>
<td>git 管理</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Dash</td>
<td>定义文档</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>GitHub Desktop</td>
<td>开源</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Progress Telerik Fiddler</td>
<td>抓包</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Wireshark</td>
<td>抓包</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>DataGrip</td>
<td>数据库</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>Sourcetrail</td>
<td>源码阅读</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>TeX</td>
<td>编辑器 - LaTeX</td>
<td>★★★</td>
<td></td>
</tr>
<tr>
<td>VirtualBox</td>
<td>虚拟机</td>
<td>★★★</td>
<td></td>
</tr>
</tbody>
</table>
<p>参考：</p>
<ul>
<li><a href="https://github.com/nteract/nteract">nteract/nteract</a> <img src="https://img.shields.io/github/stars/nteract/nteract.svg" alt="" /></li>
</ul>
<hr>
<h2 id="物化生">物化生</h2>
<h3 id="红外光栅传感器">红外光栅传感器</h3>
<h4 id="光栅httpsbaikebaiducomiteme58589e6a085"><a href="https://baike.baidu.com/item/%E5%85%89%E6%A0%85">光栅</a></h4>
<p>由大量<strong>等宽等间距的平行狭缝</strong>构成的光学器件称为光栅（grating）。</p>
<p>一般常用的光栅是在玻璃片上刻出大量平行刻痕制成，刻痕为不透光部分，两刻痕之间的光滑部分可以透光，相当于一狭缝。</p>
<p>精制的光栅，在 1cm 宽度内刻有几千条乃至上万条刻痕。</p>
<ul>
<li>利用透射光衍射的光栅称为<strong>透射光栅</strong></li>
<li>利用两刻痕间的反射光衍射的光栅，称为<strong>反射光栅</strong>
<ul>
<li>如在镀有金属层的表面上刻出许多平行刻痕，两刻痕间的光滑金属面可以反射光</li>
</ul>
</li>
</ul>
<h4 id="红外光栅httpsbaikebaiducomiteme7baa2e5a496e58589e6a085-遮挡检测"><a href="https://baike.baidu.com/item/%E7%BA%A2%E5%A4%96%E5%85%89%E6%A0%85">红外光栅</a> 遮挡检测</h4>
<p>红外光栅，（又叫电子光栅或红外栅栏）（也叫 “红外栏杆”）是主动红外对射的一种，</p>
<p>采用<strong>多束</strong>红外光对射，发射器向接收器以 “<strong>低频发射、时分检测</strong>” 方式发出红外光，一旦有人员或物体挡住了发射器发出的任何<strong>相邻两束</strong>以上光线超过 30ms 时，接收器立即输出报警信号，当有小动物或小物体挡住其中一束光线时，报警器不会输出报警信号。</p>
<hr>
<h2 id="今日总结">今日总结</h2>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">



  <div>
    
    <a class="flex align-center" href="https://github.com/ikingye/note/commit/4bf4ead094747eeff0c3a3938a6fb8c7bf121d8f" title='Last modified by yewang | 2020-04-16' target="_blank" rel="noopener">
      <img src="/note/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2020-04-16</span>
    </a>
  </div>



</div>

 
        
      </footer>

      
  
  <div class="book-comments">
<script src="https://utteranc.es/client.js"
  repo="ikingye/note"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#2020-年-4-月-8-日星期三">2020 年 4 月 8 日（星期三）</a>
      <ul>
        <li><a href="#今日待办">今日待办</a></li>
        <li><a href="#编程">编程</a>
          <ul>
            <li><a href="#依赖注入">依赖注入</a>
              <ul>
                <li><a href="#构造函数注入">构造函数注入</a></li>
                <li><a href="#属性注入">属性注入</a></li>
                <li><a href="#方法注入">方法注入</a></li>
              </ul>
            </li>
            <li><a href="#rtsphttpswwwwikiwandcomenreal_time_streaming_protocol"><a href="https://www.wikiwand.com/en/Real_Time_Streaming_Protocol">RTSP</a></a></li>
            <li><a href="#发布策略">发布策略</a>
              <ul>
                <li><a href="#蓝绿部署-blue-green-deployments">蓝绿部署 (Blue-green Deployments)</a></li>
                <li><a href="#金丝雀发布-canary-releases">金丝雀发布 (Canary Releases)</a></li>
                <li><a href="#ab-测试-ab-testing">A/B 测试 (A/B Testing)</a></li>
                <li><a href="#流量切分">流量切分</a></li>
              </ul>
            </li>
            <li><a href="#大量-time_wait-状态">大量 time_wait 状态</a>
              <ul>
                <li><a href="#time_wait-是怎么产生的">TIME_WAIT 是怎么产生的？</a>
                  <ul>
                    <li><a href="#连接关闭的过程">连接关闭的过程</a></li>
                    <li><a href="#time_wait-只会出现在主动断开连接的一方">TIME_WAIT 只会出现在主动断开连接的一方</a></li>
                  </ul>
                </li>
                <li><a href="#大量-time_wait-造成的影响">大量 TIME_WAIT 造成的影响</a></li>
                <li><a href="#排查">排查</a>
                  <ul>
                    <li><a href="#查看-tcp-各个状态的数量">查看 TCP 各个状态的数量</a></li>
                    <li><a href="#tcp-状态含义">TCP 状态含义</a></li>
                    <li><a href="#统计-time_wait-连接的本地地址">统计 TIME_WAIT 连接的本地地址</a></li>
                  </ul>
                </li>
                <li><a href="#如何尽量处理-timewait-过多的问题">如何尽量处理 TIMEWAIT 过多的问题？</a>
                  <ul>
                    <li><a href="#修改内核文件-etcsysctlconf">修改内核文件 /etc/sysctl.conf</a></li>
                    <li><a href="#nginx-配置问题">nginx 配置问题</a>
                      <ul>
                        <li><a href="#proxy_pass-与-fastcgi_pass-的区别">proxy_pass 与 fastcgi_pass 的区别</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="#为什么要有-time_wait-状态">为什么要有 TIME_WAIT 状态？</a></li>
              </ul>
            </li>
            <li><a href="#我的-macos-apps">我的 MacOS Apps</a>
              <ul>
                <li><a href="#通用">通用</a></li>
                <li><a href="#编程-1">编程</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#物化生">物化生</a>
          <ul>
            <li><a href="#红外光栅传感器">红外光栅传感器</a>
              <ul>
                <li><a href="#光栅httpsbaikebaiducomiteme58589e6a085"><a href="https://baike.baidu.com/item/%E5%85%89%E6%A0%85">光栅</a></a></li>
                <li><a href="#红外光栅httpsbaikebaiducomiteme7baa2e5a496e58589e6a085-遮挡检测"><a href="https://baike.baidu.com/item/%E7%BA%A2%E5%A4%96%E5%85%89%E6%A0%85">红外光栅</a> 遮挡检测</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#今日总结">今日总结</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
<a href="https://github.com/ikingye/note"
class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z">
  </path>
  <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm">
  </path>
  <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body">
  </path>
</svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>












