<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="2020 年 4 月 27 日（星期一） #  今日待办 #      编程 #  GB28181 #  SIP 协议 #  Antisip
 VSCode #   kasecato/vscode-intellij-idea-keybindings   运维 #  disconf #  Distributed Configuration Management Platform (分布式配置管理平台) http://disconf.readthedocs.io/
consul &#43; consul-template #  gcc vs g&#43;&#43; #   后缀为 .c 的  gcc 把它当做 C 程序 g&#43;&#43; 当做是 C&#43;&#43; 程序     编译可以用 gcc/g&#43;&#43;，而链接可以用 g&#43;&#43; 或者 gcc -lstdc&#43;&#43;  编译阶段，g&#43;&#43; 会调用 gcc，对于 c&#43;&#43; 代码，两者是等价的 gcc 命令不能自动和 C&#43;&#43; 程序使用的库联接，所以通常用 g&#43;&#43; 来完成链接 可以选择手动链接，gcc -lstdc&#43;&#43;    乐观锁 vs 悲观锁 #  乐观锁（读多写少） #  总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据， 可以使用版本号机制和 CAS 算法实现。">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="2020-04-27" />
<meta property="og:description" content="2020 年 4 月 27 日（星期一） #  今日待办 #      编程 #  GB28181 #  SIP 协议 #  Antisip
 VSCode #   kasecato/vscode-intellij-idea-keybindings   运维 #  disconf #  Distributed Configuration Management Platform (分布式配置管理平台) http://disconf.readthedocs.io/
consul &#43; consul-template #  gcc vs g&#43;&#43; #   后缀为 .c 的  gcc 把它当做 C 程序 g&#43;&#43; 当做是 C&#43;&#43; 程序     编译可以用 gcc/g&#43;&#43;，而链接可以用 g&#43;&#43; 或者 gcc -lstdc&#43;&#43;  编译阶段，g&#43;&#43; 会调用 gcc，对于 c&#43;&#43; 代码，两者是等价的 gcc 命令不能自动和 C&#43;&#43; 程序使用的库联接，所以通常用 g&#43;&#43; 来完成链接 可以选择手动链接，gcc -lstdc&#43;&#43;    乐观锁 vs 悲观锁 #  乐观锁（读多写少） #  总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据， 可以使用版本号机制和 CAS 算法实现。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ikingye.github.io/note/docs/live/diary/2020/04/27/" />
<meta property="article:modified_time" content="2020-06-09T20:34:11+08:00" />
<title>2020-04-27 | 叶王笔记</title>
<link rel="manifest" href="/note/manifest.json">
<link rel="icon" href="/note/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/note/book.min.054d088be523033861c169923260cc3eacd88fa7d58c8be9c5071b5a83323017.css" integrity="sha256-BU0Ii&#43;UjAzhhwWmSMmDMPqzYj6fVjIvpxQcbWoMyMBc=">
<script defer src="/note/en.search.min.e827ffba60eac4e121cb9aebb8c206d662845b39be45df8e7ec32db51257e59e.js" integrity="sha256-6Cf/umDqxOEhy5rruMIG1mKEWzm&#43;Rd&#43;OfsMttRJX5Z4="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/note"><span>叶王笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



<ul>
  <li><a href="https://kingye.me" target="_blank" rel="noopener noreferrer">博客</a></li>
  <li><a href="https://github.com/ikingye" target="_blank" rel="noopener noreferrer">
    Github  <img src="https://img.shields.io/github/followers/ikingye.svg?label=%E5%85%B3%E6%B3%A8">
  </a></li>
  <li><a href="https://weibo.com/kingyip15215" target="_blank" rel="noopener noreferrer">
    微博  <img src="http://www.sinaimg.cn/blog/developer/wiki/LOGO_16x16.png">
  </a></li>
  <li><a href="https://www.zhihu.com/people/wutongyip" target="_blank" rel="noopener noreferrer">知乎</a></li>
  <li><a href="//shang.qq.com/wpa/qunwpa?idkey=04022778c1def4c4938c6d1e1880f6db3abf67bbfccc9ff74baa4fa9d73c377f&source_id=1_40001" target="_blank" rel="noopener noreferrer">Q 群</a></li>
</ul>
<hr />








  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/natural/" class="">第一部分 自然科学</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/natural/math/" class="collapsed ">1.2 数学</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/natural/computer/" class="">1.5 计算机</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/humanities/" class="">第二部分 人文科学</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/humanities/language/" class="collapsed ">2.2 语言</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/humanities/music/" class="collapsed ">2.5 音乐</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/humanities/movie/" class="collapsed ">2.7 电影</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/social/" class="">第三部分 社会科学</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/social/history/" class="collapsed ">3.2 历史</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/social/economic/" class="collapsed ">3.4 经济</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/study/" class="">第四部分 学习</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/study/book/" class="collapsed ">4.1 读书</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/study/course/" class="collapsed ">4.2 课程</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/study/degree/" class="collapsed ">4.3 学位</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/study/docs/" class="collapsed ">4.4 文档</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/study/domain/" class="collapsed ">4.5 领域</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/" class="">第五部分 生活</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/" class="collapsed ">5.1 日记</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/" class="">2020 年</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/" class="">7 月</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/14/" class="">2020-07-14</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/13/" class="">2020-07-13</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/11/" class="">2020-07-11</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/10/" class="">2020-07-10</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/09/" class="">2020-07-09</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/08/" class="">2020-07-08</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/07/" class="">2020-07-07</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/06/" class="">2020-07-06</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/05/" class="">2020-07-05</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/02/" class="">2020-07-02</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/07/01/" class="">2020-07-01</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/06/" class="collapsed ">6 月</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/05/" class="collapsed ">5 月</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/" class="collapsed ">4 月</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/30/" class="">2020-04-30</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/29/" class="">2020-04-29</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/28/" class="">2020-04-28</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/27/" class="active">2020-04-27</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/26/" class="">2020-04-26</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/25/" class="">2020-04-25</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/24/" class="">2020-04-24</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/23/" class="">2020-04-23</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/22/" class="">2020-04-22</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/21/" class="">2020-04-21</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/20/" class="">2020-04-20</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/19/" class="">2020-04-19</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/17/" class="">2020-04-17</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/15/" class="">2020-04-15</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/14/" class="">2020-04-14</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/13/" class="">2020-04-13</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/12/" class="">2020-04-12</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/11/" class="">2020-04-11</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/10/" class="">2020-04-10</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/09/" class="">2020-04-09</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/08/" class="">2020-04-08</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/07/" class="">2020-04-07</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/06/" class="">2020-04-06</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/03/" class="">2020-04-03</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/04/02/" class="">2020-04-02</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/diary/2020/03/" class="collapsed ">3 月</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/parenting/" class="collapsed ">5.2 养育</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/cook/" class="collapsed ">5.5 下厨房</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/note/docs/live/travel/" class="collapsed ">5.9 旅行</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  














<hr />
<ul>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200417022040.png" target="_blank" rel="noopener noreferrer">加我微信</a></li>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200428110046.png" target="_blank" rel="noopener noreferrer">请我喝饮料</a></li>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200417021727.png" target="_blank" rel="noopener noreferrer">关注微信公众号</a></li>
</ul>

</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/note/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>2020-04-27</strong>

  <label for="toc-control">
    
    <img src="/note/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#今日待办">今日待办</a></li>
    <li><a href="#编程">编程</a>
      <ul>
        <li><a href="#gb28181">GB28181</a>
          <ul>
            <li><a href="#sip-协议">SIP 协议</a></li>
          </ul>
        </li>
        <li><a href="#vscode">VSCode</a></li>
        <li><a href="#运维">运维</a>
          <ul>
            <li><a href="#disconfhttpsgithubcomknightliaodisconf-github-starshttpsimgshieldsiogithubstarsknightliaodisconfsvg"><a href="https://github.com/knightliao/disconf">disconf</a> <img src="https://img.shields.io/github/stars/knightliao/disconf.svg" alt="Github stars"></a></li>
            <li><a href="#consul--consul-template">consul + consul-template</a></li>
          </ul>
        </li>
        <li><a href="#gcc-vs-g">gcc vs g++</a></li>
        <li><a href="#乐观锁-vs-悲观锁">乐观锁 vs 悲观锁</a>
          <ul>
            <li><a href="#乐观锁读多写少">乐观锁（读多写少）</a>
              <ul>
                <li><a href="#cas-算法">CAS 算法</a></li>
                <li><a href="#乐观锁的缺点">乐观锁的缺点</a>
                  <ul>
                    <li><a href="#aba-问题">ABA 问题</a></li>
                    <li><a href="#循环时间长开销大">循环时间长开销大</a></li>
                    <li><a href="#只能保证一个共享变量的原子操作">只能保证一个共享变量的原子操作</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#悲观锁写多读少">悲观锁（写多读少）</a></li>
          </ul>
        </li>
        <li><a href="#java-主流锁">Java 主流锁</a></li>
        <li><a href="#python-深拷贝-vs-浅拷贝">Python 深拷贝 vs 浅拷贝</a>
          <ul>
            <li><a href="#直接赋值">直接赋值</a></li>
            <li><a href="#浅拷贝-copy">浅拷贝 (copy)</a></li>
            <li><a href="#深拷贝-deepcopy">深拷贝 (deepcopy)</a></li>
            <li><a href="#应用场景">应用场景</a></li>
          </ul>
        </li>
        <li><a href="#python-垃圾回收机制">Python 垃圾回收机制</a>
          <ul>
            <li><a href="#引用计数">引用计数</a></li>
            <li><a href="#标记---清除">标记 - 清除</a></li>
            <li><a href="#分代回收">分代回收</a></li>
          </ul>
        </li>
        <li><a href="#http-code">HTTP Code</a></li>
        <li><a href="#文件上传">文件上传</a>
          <ul>
            <li><a href="#断点续传">断点续传</a></li>
          </ul>
        </li>
        <li><a href="#可扩展性">可扩展性</a>
          <ul>
            <li><a href="#设计模式可增加可扩展性">设计模式可增加可扩展性</a></li>
            <li><a href="#消息队列">消息队列</a></li>
            <li><a href="#微服务">微服务</a></li>
            <li><a href="#可扩展的数据结构">可扩展的数据结构</a></li>
          </ul>
        </li>
        <li><a href="#influxdb">InfluxDB</a></li>
      </ul>
    </li>
    <li><a href="#政治">政治</a>
      <ul>
        <li><a href="#苏哈托">苏哈托</a></li>
      </ul>
    </li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="2020-年-4-月-27-日星期一">
  2020 年 4 月 27 日（星期一）
  <a class="anchor" href="#2020-%e5%b9%b4-4-%e6%9c%88-27-%e6%97%a5%e6%98%9f%e6%9c%9f%e4%b8%80">#</a>
</h1>
<h2 id="今日待办">
  今日待办
  <a class="anchor" href="#%e4%bb%8a%e6%97%a5%e5%be%85%e5%8a%9e">#</a>
</h2>
<ul>
<li><input disabled="" type="checkbox"> </li>
</ul>
<hr>
<h2 id="编程">
  编程
  <a class="anchor" href="#%e7%bc%96%e7%a8%8b">#</a>
</h2>
<h3 id="gb28181">
  GB28181
  <a class="anchor" href="#gb28181">#</a>
</h3>
<h4 id="sip-协议">
  SIP 协议
  <a class="anchor" href="#sip-%e5%8d%8f%e8%ae%ae">#</a>
</h4>
<p><a href="https://www.antisip.com/">Antisip</a></p>
<hr>
<h3 id="vscode">
  VSCode
  <a class="anchor" href="#vscode">#</a>
</h3>
<ul>
<li><a href="https://github.com/kasecato/vscode-intellij-idea-keybindings">kasecato/vscode-intellij-idea-keybindings</a> <img src="https://img.shields.io/github/stars/kasecato/vscode-intellij-idea-keybindings.svg" alt="Github stars" /></li>
</ul>
<h3 id="运维">
  运维
  <a class="anchor" href="#%e8%bf%90%e7%bb%b4">#</a>
</h3>
<a href="https://github.com/knightliao/disconf">disconf</a> <h4 id="disconfhttpsgithubcomknightliaodisconf-github-starshttpsimgshieldsiogithubstarsknightliaodisconfsvg">
  <img src="https://img.shields.io/github/stars/knightliao/disconf.svg" alt="Github stars" />
  <a class="anchor" href="#disconfhttpsgithubcomknightliaodisconf-github-starshttpsimgshieldsiogithubstarsknightliaodisconfsvg">#</a>
</h4>
<p>Distributed Configuration Management Platform (分布式配置管理平台) <a href="http://disconf.readthedocs.io/">http://disconf.readthedocs.io/</a></p>
<h4 id="consul--consul-template">
  consul + consul-template
  <a class="anchor" href="#consul--consul-template">#</a>
</h4>
<h3 id="gcc-vs-g">
  gcc vs g++
  <a class="anchor" href="#gcc-vs-g">#</a>
</h3>
<ul>
<li>后缀为 <code>.c</code> 的
<ul>
<li>gcc 把它当做 <code>C 程序</code></li>
<li>g++ 当做是 C++ 程序</li>
</ul>
</li>
</ul>
<ul>
<li>编译可以用 gcc/g++，而链接可以用 g++ 或者 gcc -lstdc++
<ul>
<li>编译阶段，g++ 会调用 gcc，对于 c++ 代码，两者是等价的</li>
<li>gcc 命令不能自动和 C++ 程序使用的库联接，所以通常用 g++ 来完成链接</li>
<li>可以选择手动链接，gcc -lstdc++</li>
</ul>
</li>
</ul>
<h3 id="乐观锁-vs-悲观锁">
  乐观锁 vs 悲观锁
  <a class="anchor" href="#%e4%b9%90%e8%a7%82%e9%94%81-vs-%e6%82%b2%e8%a7%82%e9%94%81">#</a>
</h3>
<h4 id="乐观锁读多写少">
  乐观锁（读多写少）
  <a class="anchor" href="#%e4%b9%90%e8%a7%82%e9%94%81%e8%af%bb%e5%a4%9a%e5%86%99%e5%b0%91">#</a>
</h4>
<p>总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，
可以使用<code>版本号机制</code>和 <code>CAS 算法</code>实现。</p>
<p>乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库提供的类似于 write_condition 机制，其实都是提供的乐观锁。</p>
<p>在 Java 中 <code>java.util.concurrent.atomic</code> 包下面的原子变量类就是使用了乐观锁的一种实现方式 CAS 实现的。</p>
<h5 id="cas-算法">
  CAS 算法
  <a class="anchor" href="#cas-%e7%ae%97%e6%b3%95">#</a>
</h5>
<p>CAS 适用于写比较少的情况下（多读场景，冲突一般较少）</p>
<p>CAS (compare and swap) 比较并替换</p>
<ul>
<li>CAS (compare and swap) 比较并替换，比较和替换是线程并发算法时用到的一种技术</li>
<li>CAS 是原子操作，保证并发安全，而不是保证并发同步</li>
<li>CAS 是 CPU 的一个指令</li>
<li>CAS 是非阻塞的、轻量级的乐观锁</li>
</ul>
<p>乐观锁，严格来说并不是锁，通过原子性来保证数据的同步，比如说数据库的乐观锁，通过<code>版本控制</code>来实现等，
所以 CAS 不会保证线程同步。</p>
<p>CAS (compare and swap) 比较并替换，就是将内存值更新为需要的值，但是有个条件，内存值必须与期望值相同。</p>
<p>举个例子，期望值 E、内存值 M、更新值 U，当 E == M 的时候将 M 更新为 U。</p>
<p>由于 CAS 是 CPU 指令，我们只能通过 JNI 与操作系统交互，关于 CAS 的方法都在 sun.misc 包下 Unsafe 的类里 java.util.concurrent.atomic 包下的原子类等通过 CAS 来实现原子操作。</p>
<h5 id="乐观锁的缺点">
  乐观锁的缺点
  <a class="anchor" href="#%e4%b9%90%e8%a7%82%e9%94%81%e7%9a%84%e7%bc%ba%e7%82%b9">#</a>
</h5>
<h6 id="aba-问题">
  ABA 问题
  <a class="anchor" href="#aba-%e9%97%ae%e9%a2%98">#</a>
</h6>
<p>ABA 问题是乐观锁一个常见的问题</p>
<p>如果一个变量 V 初次读取的时候是 A 值，并且在准备赋值的时候检查到它仍然是 A 值，那我们就能说明它的值没有被其他线程修改过了吗？
很明显是不能的，因为在这段时间它的值可能被改为其他值，然后又改回 A，那 CAS 操作就会误认为它从来没有被修改过。这个问题被称为 CAS 操作的 &ldquo;ABA&rdquo; 问题。</p>
<h6 id="循环时间长开销大">
  循环时间长开销大
  <a class="anchor" href="#%e5%be%aa%e7%8e%af%e6%97%b6%e9%97%b4%e9%95%bf%e5%bc%80%e9%94%80%e5%a4%a7">#</a>
</h6>
<p>自旋 CAS（也就是不成功就一直循环执行直到成功）如果长时间不成功，会给 CPU 带来非常大的执行开销。</p>
<h6 id="只能保证一个共享变量的原子操作">
  只能保证一个共享变量的原子操作
  <a class="anchor" href="#%e5%8f%aa%e8%83%bd%e4%bf%9d%e8%af%81%e4%b8%80%e4%b8%aa%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f%e7%9a%84%e5%8e%9f%e5%ad%90%e6%93%8d%e4%bd%9c">#</a>
</h6>
<p>CAS 只对单个共享变量有效，当操作涉及跨多个共享变量时 CAS 无效。但是从 JDK 1.5 开始，提供了 AtomicReference 类来保证引用对象之间的原子性，你可以把多个变量放在一个对象里来进行 CAS 操作。所以我们可以使用锁或者利用 AtomicReference 类把多个共享变量合并成一个共享变量来操作。</p>
<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5a803e61f265da4e914b5b63">深入分析 CAS（乐观锁）</a></li>
</ul>
<h4 id="悲观锁写多读少">
  悲观锁（写多读少）
  <a class="anchor" href="#%e6%82%b2%e8%a7%82%e9%94%81%e5%86%99%e5%a4%9a%e8%af%bb%e5%b0%91">#</a>
</h4>
<p>总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁</p>
<p>传统的关系型数据库里边就用到了很多这种锁机制，比如<code>行锁</code>，<code>表锁</code>等，读锁，写锁等，都是在做操作之前先上锁。</p>
<p>Java 中 <code>synchronized</code> 和 <code>ReentrantLock</code> 等独占锁就是悲观锁思想的实现</p>
<p>synchronized 适用于写比较多的情况下（多写场景，冲突一般较多）</p>
<p>Java 并发编程这个领域中 synchronized 关键字一直都是元老级的角色，很久之前很多人都会称它为 “重量级锁” 。但是，在 JavaSE 1.6 之后进行了主要包括为了减少获得锁和释放锁带来的性能消耗而引入的 偏向锁 和 轻量级锁 以及其它各种优化之后变得在某些情况下并不是那么重了。synchronized 的底层实现主要依靠 Lock-Free 的队列，基本思路是 自旋后阻塞，竞争切换后继续竞争锁，稍微牺牲了公平性，但获得了高吞吐量。在线程冲突较少的情况下，可以获得和 CAS 类似的性能；而线程冲突严重的情况下，性能远高于 CAS。</p>
<h3 id="java-主流锁">
  Java 主流锁
  <a class="anchor" href="#java-%e4%b8%bb%e6%b5%81%e9%94%81">#</a>
</h3>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200427153342.png" alt="" /></p>
<p>参考：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/50098743">【基本功】不可不说的 Java “锁” 事</a></li>
</ul>
<h3 id="python-深拷贝-vs-浅拷贝">
  Python 深拷贝 vs 浅拷贝
  <a class="anchor" href="#python-%e6%b7%b1%e6%8b%b7%e8%b4%9d-vs-%e6%b5%85%e6%8b%b7%e8%b4%9d">#</a>
</h3>
<p>深拷贝和浅拷贝的不同仅仅是对组合对象而言，所谓的组合对象就是包含了其他对象的对象，如列表，类实例。
而对于数字，字符串，没有拷贝这一说，产生的都是原对象的引用。</p>
<h4 id="直接赋值">
  直接赋值
  <a class="anchor" href="#%e7%9b%b4%e6%8e%a5%e8%b5%8b%e5%80%bc">#</a>
</h4>
<p>其实就是对象的引用（别名）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200427154218.png" alt="" /></p>
<h4 id="浅拷贝-copy">
  浅拷贝 (copy)
  <a class="anchor" href="#%e6%b5%85%e6%8b%b7%e8%b4%9d-copy">#</a>
</h4>
<p>拷贝父对象，不会拷贝对象的内部的子对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200427154242.png" alt="" /></p>
<h4 id="深拷贝-deepcopy">
  深拷贝 (deepcopy)
  <a class="anchor" href="#%e6%b7%b1%e6%8b%b7%e8%b4%9d-deepcopy">#</a>
</h4>
<p>copy 模块的 deepcopy 方法，完全拷贝了父对象及其子对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200427154258.png" alt="" /></p>
<h4 id="应用场景">
  应用场景
  <a class="anchor" href="#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af">#</a>
</h4>
<p>参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/zhuifeng-mayi/p/9179647.html">简述 Python 的深浅拷贝以及应用场景</a></li>
</ul>
<hr>
<h3 id="python-垃圾回收机制">
  Python 垃圾回收机制
  <a class="anchor" href="#python-%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e6%9c%ba%e5%88%b6">#</a>
</h3>
<h4 id="引用计数">
  引用计数
  <a class="anchor" href="#%e5%bc%95%e7%94%a8%e8%ae%a1%e6%95%b0">#</a>
</h4>
<p>跟踪和回收垃圾</p>
<p>在 Python 中，大多数对象的生命周期都是通过对象的引用计数来管理的。
从广义上来讲，引用计数也是一种垃圾收集机制，而且也是一种最直观，最简单的垃圾收集技术。</p>
<p>原理：
当一个对象的引用被创建或者复制时，对象的引用计数加 1；
当一个对象的引用被销毁时，对象的引用计数减 1；
当对象的引用计数减少为 0 时，就意味着对象已经没有被任何人使用了，可以将其所占用的内存释放了。</p>
<h4 id="标记---清除">
  标记 - 清除
  <a class="anchor" href="#%e6%a0%87%e8%ae%b0---%e6%b8%85%e9%99%a4">#</a>
</h4>
<p>解决容器对象可能产生的循环引用的问题</p>
<p>标记 - 清除” 是为了解决循环引用的问题。可以包含其他对象引用的容器对象（比如：list，set，dict，class，instance）都可能产生循环引用。</p>
<p>我们必须承认一个事实，如果两个对象的引用计数都为 1，但是仅仅存在他们之间的循环引用，那么这两个对象都是需要被回收的，也就是说，它们的引用计数虽然表现为非 0，但实际上有效的引用计数为 0。</p>
<p>原理：“标记 - 清除” 并不改动真实的引用计数，而是将集合中对象的引用计数复制一份副本，改动该对象引用的副本。对于副本做任何的改动，都不会影响到对象生命走起的维护。</p>
<h4 id="分代回收">
  分代回收
  <a class="anchor" href="#%e5%88%86%e4%bb%a3%e5%9b%9e%e6%94%b6">#</a>
</h4>
<p>以空间换取时间来进一步提高垃圾回收的效率</p>
<p>无论使用何种语言开发，无论开发的是何种类型，何种规模的程序，都存在这样一点相同之处。
即：
一定比例的内存块的生存周期都比较短，通常是几百万条机器指令的时间，而剩下的内存块，起生存周期比较长，甚至会从程序开始一直持续到程序结束。</p>
<p>原理：将系统中的所有内存块根据其存活时间划分为不同的集合，每一个集合就成为一个 “代”，垃圾收集的频率随着 “代” 的存活时间的增大而减小。也就是说，活得越长的对象，就越不可能是垃圾，就应该减少对它的垃圾收集频率。那么如何来衡量这个存活时间：通常是利用几次垃圾收集动作来衡量，如果一个对象经过的垃圾收集次数越多，可以得出：该对象存活时间就越长。</p>
<p>参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/zhuifeng-mayi/p/9179972.html">Python 垃圾回收机制？</a></li>
</ul>
<hr>
<h3 id="http-code">
  HTTP Code
  <a class="anchor" href="#http-code">#</a>
</h3>
<ul>
<li>200: 服务器成功返回请求的数据。</li>
<li>201: 新建或修改数据成功。</li>
<li>202: 一个请求已经进入后台排队（异步任务）。</li>
<li>204: 删除数据成功。</li>
<li>304：协商缓存</li>
<li>400: 发出的请求有错误，服务器没有进行新建或修改数据的操作。</li>
<li>401: 用户没有权限（令牌、用户名、密码错误）。</li>
<li>403: 用户得到授权，但是访问是被禁止的。</li>
<li>404: 发出的请求针对的是不存在的记录，服务器没有进行操作。</li>
<li>406: 请求的格式不可得。</li>
<li>410: 请求的资源被永久删除，且不会再得到的。</li>
<li>422: 当创建一个对象时，发生一个验证错误。</li>
<li>500: 服务器发生错误，请检查服务器。</li>
<li>502: 网关错误。</li>
<li>503: 服务不可用，服务器暂时过载或维护。</li>
<li>504: 网关超时。</li>
</ul>
<h3 id="文件上传">
  文件上传
  <a class="anchor" href="#%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0">#</a>
</h3>
<p>根据 http 协议的规范和定义，完成请求消息体的封装和消息体的解析，然后将二进制内容保存到文件。</p>
<ul>
<li>form 标签的 enctype 设置为 <code>multipart/form-data</code>
<ul>
<li>multipart 互联网上的混合资源，就是资源由多种元素组成</li>
<li>form-data 表示可以使用 HTML Forms 和 POST 方法上传文件</li>
<li>具体的定义可以参考 RFC 7578</li>
</ul>
</li>
<li>method 必须为 post 方法</li>
</ul>
<h4 id="断点续传">
  断点续传
  <a class="anchor" href="#%e6%96%ad%e7%82%b9%e7%bb%ad%e4%bc%a0">#</a>
</h4>
<p>服务端增加一个获取分片的接口供客户端调用</p>
<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5da14778f265da5bb628e590">各种文件上传攻略，从小图片到大文件断点续传</a></li>
</ul>
<h3 id="可扩展性">
  可扩展性
  <a class="anchor" href="#%e5%8f%af%e6%89%a9%e5%b1%95%e6%80%a7">#</a>
</h3>
<h4 id="设计模式可增加可扩展性">
  设计模式可增加可扩展性
  <a class="anchor" href="#%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%e5%8f%af%e5%a2%9e%e5%8a%a0%e5%8f%af%e6%89%a9%e5%b1%95%e6%80%a7">#</a>
</h4>
<p>工厂模式</p>
<p>抽象工厂模式</p>
<p>观察者模式：很方便增加观察者，方便系统扩展</p>
<p>模板方法模式：很方便的实现不稳定的扩展点，完成功能的重用</p>
<p>适配器模式：可以很方便地对适配其他接口</p>
<p>代理模式：可以很方便在原来功能的基础上增加功能或者逻辑</p>
<p>责任链模式：可以很方便得增加拦截器 / 过滤器实现对数据的处理，比如 struts2 的责任链</p>
<p>策略模式：通过新增策略从而改变原来的执行策略</p>
<h4 id="消息队列">
  消息队列
  <a class="anchor" href="#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97">#</a>
</h4>
<h4 id="微服务">
  微服务
  <a class="anchor" href="#%e5%be%ae%e6%9c%8d%e5%8a%a1">#</a>
</h4>
<h4 id="可扩展的数据结构">
  可扩展的数据结构
  <a class="anchor" href="#%e5%8f%af%e6%89%a9%e5%b1%95%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84">#</a>
</h4>
<p>使用 NoSQL 数据库（如 Cassandra）的 ColumnFamily （列族）技术可以做到可扩展的数据结构设计。它是一种面向列族的稀疏矩阵的存储格式。</p>
<p>只需要指定 ColumnFamily 的名字，即可创建表。字段可以在写入数据时再指定，通过这种方式，一张表可以包含数百万个字段。这就使得应用的数据结构可以随意扩展。只需要指定任意字段名称和值即可查询。</p>
<hr>
<h3 id="influxdb">
  InfluxDB
  <a class="anchor" href="#influxdb">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Usage:
    connect &lt;host:port&gt;   connects to another node specified by host:port
    auth                  prompts <span style="color:#66d9ef">for</span> username and password
    pretty                toggles pretty print <span style="color:#66d9ef">for</span> the json format
    chunked               turns on chunked responses from server
    chunk size &lt;size&gt;     sets the size of the chunked responses.  Set to <span style="color:#ae81ff">0</span> to reset to the default chunked size
    use &lt;db_name&gt;         sets current database
    format &lt;format&gt;       specifies the format of the server responses: json, csv, or column
    precision &lt;format&gt;    specifies the format of the timestamp: rfc3339, h, m, s, ms, u or ns
    consistency &lt;level&gt;   sets write consistency level: any, one, quorum, or all
    history               displays command history
    settings              outputs the current settings <span style="color:#66d9ef">for</span> the shell
    clear                 clears settings such as database or retention policy.  run <span style="color:#e6db74">&#39;clear&#39;</span> <span style="color:#66d9ef">for</span> help
    exit/quit/ctrl+d      quits the influx shell

    show databases        show database names
    show series           show series information
    show measurements     show measurement information
    show tag keys         show tag key information
    show field keys       show field key information

    A full list of influxql commands can be found at:
    https://docs.influxdata.com/influxdb/latest/query_language/spec/
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">influx <span style="color:#f92672">-</span><span style="color:#66d9ef">precision</span> rfc3339

<span style="color:#f92672">#</span> <span style="color:#66d9ef">database</span>
<span style="color:#66d9ef">SHOW</span> DATABASES
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> mydb
USE mydb


<span style="color:#66d9ef">INSERT</span> cpu,<span style="color:#66d9ef">host</span><span style="color:#f92672">=</span>serverA,region<span style="color:#f92672">=</span>us_west value<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">64</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;host&#34;</span>, <span style="color:#e6db74">&#34;region&#34;</span>, <span style="color:#e6db74">&#34;value&#34;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#34;cpu&#34;</span>


<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">/</span>.<span style="color:#f92672">*/</span> <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>

</code></pre></div><p>参考：</p>
<ul>
<li><a href="https://jasper-zhang1.gitbooks.io/influxdb/content/">Influx 中文指南</a></li>
</ul>
<hr>
<h2 id="政治">
  政治
  <a class="anchor" href="#%e6%94%bf%e6%b2%bb">#</a>
</h2>
<h3 id="苏哈托">
  苏哈托
  <a class="anchor" href="#%e8%8b%8f%e5%93%88%e6%89%98">#</a>
</h3>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/ikingye/note/commit/fccfb3aba9fc5d00e0f0014c9b4a3984a32e2f63" title='Last modified by yewang | 2020-06-09' target="_blank" rel="noopener">
      <img src="/note/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2020-06-09</span>
    </a>
  </div>



</div>

 
        
      </footer>

      
  
  <div class="book-comments">
<script src="https://utteranc.es/client.js"
  repo="ikingye/note"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#今日待办">今日待办</a></li>
    <li><a href="#编程">编程</a>
      <ul>
        <li><a href="#gb28181">GB28181</a>
          <ul>
            <li><a href="#sip-协议">SIP 协议</a></li>
          </ul>
        </li>
        <li><a href="#vscode">VSCode</a></li>
        <li><a href="#运维">运维</a>
          <ul>
            <li><a href="#disconfhttpsgithubcomknightliaodisconf-github-starshttpsimgshieldsiogithubstarsknightliaodisconfsvg"><a href="https://github.com/knightliao/disconf">disconf</a> <img src="https://img.shields.io/github/stars/knightliao/disconf.svg" alt="Github stars"></a></li>
            <li><a href="#consul--consul-template">consul + consul-template</a></li>
          </ul>
        </li>
        <li><a href="#gcc-vs-g">gcc vs g++</a></li>
        <li><a href="#乐观锁-vs-悲观锁">乐观锁 vs 悲观锁</a>
          <ul>
            <li><a href="#乐观锁读多写少">乐观锁（读多写少）</a>
              <ul>
                <li><a href="#cas-算法">CAS 算法</a></li>
                <li><a href="#乐观锁的缺点">乐观锁的缺点</a>
                  <ul>
                    <li><a href="#aba-问题">ABA 问题</a></li>
                    <li><a href="#循环时间长开销大">循环时间长开销大</a></li>
                    <li><a href="#只能保证一个共享变量的原子操作">只能保证一个共享变量的原子操作</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#悲观锁写多读少">悲观锁（写多读少）</a></li>
          </ul>
        </li>
        <li><a href="#java-主流锁">Java 主流锁</a></li>
        <li><a href="#python-深拷贝-vs-浅拷贝">Python 深拷贝 vs 浅拷贝</a>
          <ul>
            <li><a href="#直接赋值">直接赋值</a></li>
            <li><a href="#浅拷贝-copy">浅拷贝 (copy)</a></li>
            <li><a href="#深拷贝-deepcopy">深拷贝 (deepcopy)</a></li>
            <li><a href="#应用场景">应用场景</a></li>
          </ul>
        </li>
        <li><a href="#python-垃圾回收机制">Python 垃圾回收机制</a>
          <ul>
            <li><a href="#引用计数">引用计数</a></li>
            <li><a href="#标记---清除">标记 - 清除</a></li>
            <li><a href="#分代回收">分代回收</a></li>
          </ul>
        </li>
        <li><a href="#http-code">HTTP Code</a></li>
        <li><a href="#文件上传">文件上传</a>
          <ul>
            <li><a href="#断点续传">断点续传</a></li>
          </ul>
        </li>
        <li><a href="#可扩展性">可扩展性</a>
          <ul>
            <li><a href="#设计模式可增加可扩展性">设计模式可增加可扩展性</a></li>
            <li><a href="#消息队列">消息队列</a></li>
            <li><a href="#微服务">微服务</a></li>
            <li><a href="#可扩展的数据结构">可扩展的数据结构</a></li>
          </ul>
        </li>
        <li><a href="#influxdb">InfluxDB</a></li>
      </ul>
    </li>
    <li><a href="#政治">政治</a>
      <ul>
        <li><a href="#苏哈托">苏哈托</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
<a href="https://github.com/ikingye/note"
class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
  <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
  <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
</svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>












